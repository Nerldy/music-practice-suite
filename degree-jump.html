<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Practice Suite</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for standalone execution -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 selection:bg-indigo-500/30">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // --- GLOBAL CONSTANTS & DATA ---
        const NOTES_REF = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
        const COF_FLATS = ['C', 'G', 'D', 'A', 'E', 'B', 'Gb', 'Db', 'Ab', 'Eb', 'Bb', 'F'];
        const COF_SHARPS = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#', 'G#', 'D#', 'A#', 'F'];

        const MAJOR_SCALES = {
            'C': ['C', 'D', 'E', 'F', 'G', 'A', 'B'],
            'G': ['G', 'A', 'B', 'C', 'D', 'E', 'F‚ôØ'],
            'D': ['D', 'E', 'F‚ôØ', 'G', 'A', 'B', 'C‚ôØ'],
            'A': ['A', 'B', 'C‚ôØ', 'D', 'E', 'F‚ôØ', 'G‚ôØ'],
            'E': ['E', 'F‚ôØ', 'G‚ôØ', 'A', 'B', 'C‚ôØ', 'D‚ôØ'],
            'B': ['B', 'C‚ôØ', 'D‚ôØ', 'E', 'F‚ôØ', 'G‚ôØ', 'A‚ôØ'],
            'F#': ['F‚ôØ', 'G‚ôØ', 'A‚ôØ', 'B', 'C‚ôØ', 'D‚ôØ', 'E‚ôØ'],
            'C#': ['C‚ôØ', 'D‚ôØ', 'E‚ôØ', 'F‚ôØ', 'G‚ôØ', 'A‚ôØ', 'B‚ôØ'],
            'G#': ['G‚ôØ', 'A‚ôØ', 'B‚ôØ', 'C‚ôØ', 'D‚ôØ', 'E‚ôØ', 'F‚ôØ‚ôØ'],
            'D#': ['D‚ôØ', 'E‚ôØ', 'F‚ôØ‚ôØ', 'G‚ôØ', 'A‚ôØ', 'B‚ôØ', 'C‚ôØ‚ôØ'],
            'A#': ['A‚ôØ', 'B‚ôØ', 'C‚ôØ‚ôØ', 'D‚ôØ', 'E‚ôØ', 'F‚ôØ‚ôØ', 'G‚ôØ‚ôØ'],
            'Gb': ['G‚ô≠', 'A‚ô≠', 'B‚ô≠', 'C‚ô≠', 'D‚ô≠', 'E‚ô≠', 'F'],
            'Db': ['D‚ô≠', 'E‚ô≠', 'F', 'G‚ô≠', 'A‚ô≠', 'B‚ô≠', 'C'],
            'Ab': ['A‚ô≠', 'B‚ô≠', 'C', 'D‚ô≠', 'E‚ô≠', 'F', 'G'],
            'Eb': ['E‚ô≠', 'F', 'G', 'A‚ô≠', 'B‚ô≠', 'C', 'D'],
            'Bb': ['B‚ô≠', 'C', 'D', 'E‚ô≠', 'F', 'G', 'A'],
            'F': ['F', 'G', 'A', 'B‚ô≠', 'C', 'D', 'E'],
        };

        const MINOR_SCALES = {
            'C': ['C', 'D', 'E‚ô≠', 'F', 'G', 'A‚ô≠', 'B‚ô≠'],
            'G': ['G', 'A', 'B‚ô≠', 'C', 'D', 'E‚ô≠', 'F'],
            'D': ['D', 'E', 'F', 'G', 'A', 'B‚ô≠', 'C'],
            'A': ['A', 'B', 'C', 'D', 'E', 'F', 'G'],
            'E': ['E', 'F‚ôØ', 'G', 'A', 'B', 'C', 'D'],
            'B': ['B', 'C‚ôØ', 'D', 'E', 'F‚ôØ', 'G', 'A'],
            'F#': ['F‚ôØ', 'G‚ôØ', 'A', 'B', 'C‚ôØ', 'D', 'E'],
            'C#': ['C‚ôØ', 'D‚ôØ', 'E', 'F‚ôØ', 'G‚ôØ', 'A', 'B'],
            'G#': ['G‚ôØ', 'A‚ôØ', 'B', 'C‚ôØ', 'D‚ôØ', 'E', 'F‚ôØ'],
            'D#': ['D‚ôØ', 'E‚ôØ', 'F‚ôØ', 'G‚ôØ', 'A‚ôØ', 'B', 'C‚ôØ'],
            'A#': ['A‚ôØ', 'B‚ôØ', 'C‚ôØ', 'D‚ôØ', 'E‚ôØ', 'F‚ôØ', 'G‚ôØ'],
            'Gb': ['G‚ô≠', 'A‚ô≠', 'B‚ô≠‚ô≠', 'C‚ô≠', 'D‚ô≠', 'E‚ô≠‚ô≠', 'F‚ô≠'],
            'Db': ['D‚ô≠', 'E‚ô≠', 'F‚ô≠', 'G‚ô≠', 'A‚ô≠', 'B‚ô≠‚ô≠', 'C‚ô≠'],
            'Ab': ['A‚ô≠', 'B‚ô≠', 'C‚ô≠', 'D‚ô≠', 'E‚ô≠', 'F‚ô≠', 'G‚ô≠'],
            'Eb': ['E‚ô≠', 'F', 'G‚ô≠', 'A‚ô≠', 'B‚ô≠', 'C‚ô≠', 'D‚ô≠'],
            'Bb': ['B‚ô≠', 'C', 'D‚ô≠', 'E‚ô≠', 'F', 'G‚ô≠', 'A‚ô≠'],
            'F': ['F', 'G', 'A‚ô≠', 'B‚ô≠', 'C', 'D‚ô≠', 'E‚ô≠'],
        };

        const NOTE_POOLS = {
            'sharps': ['C', 'C‚ôØ', 'D', 'D‚ôØ', 'E', 'E‚ôØ', 'F', 'F‚ôØ', 'G', 'G‚ôØ', 'A', 'A‚ôØ', 'B', 'B‚ôØ'],
            'flats': ['C', 'C‚ô≠', 'D', 'D‚ô≠', 'E', 'E‚ô≠', 'F', 'F‚ô≠', 'G', 'G‚ô≠', 'A', 'A‚ô≠', 'B', 'B‚ô≠'],
            'mixed': ['C', 'C‚ôØ', 'D‚ô≠', 'D', 'D‚ôØ', 'E‚ô≠', 'E', 'E‚ôØ', 'F', 'F‚ô≠', 'F‚ôØ', 'G‚ô≠', 'G', 'G‚ôØ', 'A‚ô≠', 'A', 'A‚ôØ', 'B‚ô≠', 'B', 'C‚ô≠', 'B‚ôØ']
        };

        const CHROMATIC_INTERVALS = [
            { name: 'P1', semitones: 0 }, { name: 'Min 2', semitones: 1 }, { name: 'Maj 2', semitones: 2 },
            { name: 'Min 3', semitones: 3 }, { name: 'Maj 3', semitones: 4 }, { name: 'P4', semitones: 5 },
            { name: 'Tritone', semitones: 6 }, { name: 'P5', semitones: 7 }, { name: 'Min 6', semitones: 8 },
            { name: 'Maj 6', semitones: 9 }, { name: 'Min 7', semitones: 10 }, { name: 'Maj 7', semitones: 11 },
            { name: 'P8', semitones: 12 },
        ];
        const DIATONIC_INTERVAL_NAMES = { 0: '1st', 1: '2nd', 2: '3rd', 3: '4th', 4: '5th', 5: '6th', 6: '7th', 7: '8th' };

        // --- AUDIO ENGINE ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const playTone = (freq, duration, type = 'sine', volume = 0.1) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = type;
            oscillator.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gainNode.gain.setValueAtTime(volume, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + duration);
        };
        const playBeep = () => playTone(440, 0.1, 'sine', 0.05);
        const playTing = () => playTone(1200, 0.3, 'sine', 0.1);

        // --- UTILITY FUNCTIONS ---
        function formatNote(note) {
            return note ? note.replace('#', '‚ôØ').replace('b', '‚ô≠') : '';
        }

        function getNoteChromaticIndex(note) {
            const normalized = note.replace('‚ôØ‚ôØ', '##').replace('‚ôØ', '#').replace('‚ô≠‚ô≠', 'bb').replace('‚ô≠', 'b');
            const baseMap = { 'C': 0, 'D': 2, 'E': 4, 'F': 5, 'G': 7, 'A': 9, 'B': 11 };
            const base = normalized[0];
            let idx = baseMap[base];
            const rest = normalized.slice(1);
            for (const char of rest) {
                if (char === '#') idx++;
                if (char === 'b') idx--;
            }
            return (idx % 12 + 12) % 12;
        }

        function calculateDiatonic(scale, startDegree, intervalSteps, direction) {
            const startIndex = startDegree - 1;
            let targetIndex;
            if (direction === 'up') targetIndex = (startIndex + intervalSteps) % 7;
            else {
                targetIndex = (startIndex - intervalSteps) % 7;
                while (targetIndex < 0) targetIndex += 7;
            }
            return scale[targetIndex % 7];
        }

        function calculateChromatic(startNote, semitones, direction) {
            let sIdx = getNoteChromaticIndex(startNote);
            let eIdx = direction === 'up' ? (sIdx + semitones) : (sIdx - semitones);
            const resultIdx = (eIdx % 12 + 12) % 12;
            return formatNote(NOTES_REF[resultIdx]);
        }

        // --- ICON SYSTEM ---
        function Icon({ children, size = 24, className = "", fill = "none" }) {
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {children}
                </svg>
            );
        }

        function Footprints(props) { return <Icon {...props}><path d="M4 17.5c0-1.4 1.1-2.5 2.5-2.5s2.5 1.1 2.5 2.5c0 1.9-1.1 2.5-2.5 2.5S4 19.4 4 17.5z" opacity="0.4" /><path d="M15 6.5c0-1.4 1.1-2.5 2.5-2.5s2.5 1.1 2.5 2.5c0 1.9-1.1 2.5-2.5 2.5s-2.5-.6-2.5-2.5z" /><path d="M7 14c1.5-4 5-6 9-7" /><path d="m13 7 3-1-1 3" /></Icon>; }
        function MusicIcon(props) { return <Icon {...props}><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></Icon>; }
        function ChevronUp(props) { return <Icon {...props}><path d="m18 15-6-6-6 6"/></Icon>; }
        function ChevronDown(props) { return <Icon {...props}><path d="m6 9 6 6 6-6"/></Icon>; }
        function Shuffle(props) { return <Icon {...props}><path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22"/><path d="m18 2 4 4-4 4"/><path d="M2 6h1.9c1.2 0 2.3.6 3 1.5l3.8 5"/><path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8"/><path d="m18 14 4 4-4 4"/></Icon>; }
        function Dices(props) { return <Icon {...props}><rect width="12" height="12" x="2" y="10" rx="2" ry="2"/><path d="m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3.17l-3.5-3.5a2.24 2.24 0 0 0-3.17 0L12.75 5.58"/><circle cx="8" cy="16" r="1"/><path d="M15 10h.01"/><path d="M18 13h.01"/><path d="M18 7h.01"/></Icon>; }
        function Clock(props) { return <Icon {...props}><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></Icon>; }
        function Play(props) { return <Icon {...props}><polygon points="5 3 19 12 5 21 5 3"/></Icon>; }
        function Square(props) { return <Icon {...props}><rect width="18" height="18" x="3" y="3" rx="2"/></Icon>; }
        function RefreshCw(props) { return <Icon {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></Icon>; }
        function ChevronRight(props) { return <Icon {...props}><path d="m9 18 6-6-6-6"/></Icon>; }
        function RotateCcw(props) { return <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>; }
        function Layers(props) { return <Icon {...props}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></Icon>; }
        function Zap(props) { return <Icon {...props}><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></Icon>; }
        function HomeIcon(props) { return <Icon {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></Icon>; }

        // --- SHARED UI COMPONENTS ---
        function NoteDisplayComponent({ note, className = "" }) {
            if (!note) return null;
            const displayStr = formatNote(note);
            const match = displayStr.match(/^([A-G1-8])([‚ôØ‚ô≠\+ùÑ™]+)?$/) || [null, displayStr, null];
            const [_, letter, accidental] = match;
            return (
                <span className={className}>
                    {letter}
                    {accidental && <sup className="text-[0.45em] -top-[0.6em] ml-0.5 opacity-90 tracking-tighter">{accidental}</sup>}
                </span>
            );
        }

        function Navbar({ activeView, onNavigate }) {
            return (
                <nav className="fixed top-0 left-0 right-0 bg-slate-900 border-b border-slate-800 z-50 px-4">
                    <div className="max-w-7xl mx-auto flex items-center justify-between h-14">
                        <button onClick={() => onNavigate('home')} className="flex items-center gap-2 text-white font-black text-sm tracking-tighter uppercase italic hover:opacity-80 transition-all active:scale-95">
                            <MusicIcon size={18} className="text-indigo-500" />
                            <span>Practice <span className="text-slate-500 font-bold">Suite</span></span>
                        </button>
                        <div className="flex items-center gap-1 md:gap-4">
                            <button onClick={() => onNavigate('degreeJump')} className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${activeView === 'degreeJump' ? 'bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 shadow-[0_0_15px_rgba(99,102,241,0.1)]' : 'text-slate-500 hover:text-white'}`}>
                                <Footprints size={14} /> <span className="hidden md:inline">Degree Jump</span>
                            </button>
                            <button onClick={() => onNavigate('noteFlasher')} className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${activeView === 'noteFlasher' ? 'bg-rose-500/10 text-rose-400 border border-rose-500/20 shadow-[0_0_15px_rgba(244,63,94,0.1)]' : 'text-slate-500 hover:text-white'}`}>
                                <Zap size={14} /> <span className="hidden md:inline">Note Flasher</span>
                            </button>
                        </div>
                    </div>
                </nav>
            );
        }

        // --- DEGREE JUMP MODULE ---

        function DegreeJump() {
            const [mode, setMode] = useState('diatonic');
            const [selectedKey, setSelectedKey] = useState('C');
            const [randomizeKey, setRandomizeKey] = useState(false);
            const [scaleType, setScaleType] = useState('major'); 
            const [anchorDisplay, setAnchorDisplay] = useState('note');
            const [accidentalMode, setAccidentalMode] = useState('flats');
            const [scaleDegree, setScaleDegree] = useState(1); 
            const [directionPref, setDirectionPref] = useState('up'); 
            const [lockStartNote, setLockStartNote] = useState(true);
            const [noRepeats, setNoRepeats] = useState(false);
            const [timerEnabled, setTimerEnabled] = useState(false);
            const [timerRunning, setTimerRunning] = useState(false);
            const [timerSeconds, setTimerSeconds] = useState(30);
            const [timeLeft, setTimeLeft] = useState(30);
            
            const [enabledIntervals, setEnabledIntervals] = useState([0, 1, 2, 3, 4, 5, 6, 7]);
            const [currentTask, setCurrentTask] = useState(null);
            const [showTarget, setShowTarget] = useState(false);
            const [pool, setPool] = useState([]);
            const [sessionComplete, setSessionComplete] = useState(false);

            const totalPossibleCount = useMemo(() => mode === 'diatonic' ? 8 : CHROMATIC_INTERVALS.length, [mode]);
            const sessionTotal = useMemo(() => {
                const degreeMultiplier = (scaleDegree === 'random') ? 7 : 1;
                const keyMultiplier = randomizeKey ? 12 : 1;
                const directionMultiplier = (directionPref === 'random') ? 2 : 1;
                return enabledIntervals.length * degreeMultiplier * keyMultiplier * directionMultiplier;
            }, [enabledIntervals, scaleDegree, randomizeKey, directionPref]);

            const currentCOF = useMemo(() => accidentalMode === 'flats' ? COF_FLATS : COF_SHARPS, [accidentalMode]);
            const currentScale = useMemo(() => {
                const library = scaleType === 'major' ? MAJOR_SCALES : MINOR_SCALES;
                return library[selectedKey] || library['C'];
            }, [selectedKey, scaleType]);
            
            const availableIntervals = useMemo(() => {
                return mode === 'diatonic' 
                    ? Object.keys(DIATONIC_INTERVAL_NAMES).map(k => ({ id: parseInt(k), name: DIATONIC_INTERVAL_NAMES[k] }))
                    : CHROMATIC_INTERVALS.map((int, i) => ({ id: i, name: int.name }));
            }, [mode]);

            const getDegreeLabel = useCallback((degIndex) => {
                if (scaleType === 'major') return (degIndex + 1).toString();
                const minorLabels = ['1', '2', 'b3', '4', '5', 'b6', 'b7'];
                return minorLabels[degIndex] || (degIndex + 1).toString();
            }, [scaleType]);

            const generateTaskFromPool = useCallback((inputPool, isSilent = false) => {
                if (!inputPool || inputPool.length === 0) {
                    if (noRepeats) setSessionComplete(true);
                    return null;
                }

                setShowTarget(false);
                setTimeLeft(timerSeconds);
                if (!isSilent) playTing();

                let effectiveDegree, intervalIndex, effectiveKey, direction;

                if (noRepeats) {
                    const poolIdx = Math.floor(Math.random() * inputPool.length);
                    const item = inputPool[poolIdx];
                    effectiveDegree = item.degree;
                    intervalIndex = item.interval;
                    effectiveKey = item.key;
                    direction = item.direction;
                    
                    const newPool = [...inputPool];
                    newPool.splice(poolIdx, 1);
                    setPool(newPool);
                } else {
                    effectiveDegree = scaleDegree === 'random' ? Math.floor(Math.random() * 7) + 1 : scaleDegree;
                    intervalIndex = enabledIntervals[Math.floor(Math.random() * enabledIntervals.length)];
                    effectiveKey = randomizeKey ? currentCOF[Math.floor(Math.random() * currentCOF.length)] : selectedKey;
                    direction = directionPref === 'random' ? (Math.random() > 0.5 ? 'up' : 'down') : directionPref;
                }

                if (randomizeKey && effectiveKey !== selectedKey) {
                    setSelectedKey(effectiveKey);
                }

                const activeScale = scaleType === 'major' ? MAJOR_SCALES[effectiveKey] : MINOR_SCALES[effectiveKey];
                const startNote = lockStartNote ? activeScale[effectiveDegree - 1] : activeScale[Math.floor(Math.random() * 7)];

                let task;
                if (mode === 'diatonic') {
                    const label = DIATONIC_INTERVAL_NAMES[intervalIndex];
                    const note = calculateDiatonic(activeScale, effectiveDegree, intervalIndex, direction);
                    task = { startNote, endNote: note, label, direction, activeDegree: effectiveDegree, key: effectiveKey };
                } else {
                    const interval = CHROMATIC_INTERVALS[intervalIndex];
                    const note = calculateChromatic(startNote, interval.semitones, direction);
                    task = { startNote, endNote: note, label: interval.name, direction, activeDegree: effectiveDegree, key: effectiveKey };
                }
                setCurrentTask(task);
                return task;
            }, [mode, selectedKey, scaleDegree, randomizeKey, lockStartNote, directionPref, noRepeats, timerSeconds, enabledIntervals, currentCOF, scaleType]);

            const nextTask = useCallback((shouldMute = false) => {
                generateTaskFromPool(pool, shouldMute);
            }, [generateTaskFromPool, pool]);

            const resetPool = useCallback((keepTimerStatus = false) => {
                let newPool = [];
                const keysToUse = randomizeKey ? currentCOF : [selectedKey];
                const degreesToUse = scaleDegree === 'random' ? [1,2,3,4,5,6,7] : [scaleDegree];
                const directionsToUse = directionPref === 'random' ? ['up', 'down'] : [directionPref];

                for (const k of keysToUse) {
                    for (const d of degreesToUse) {
                        for (const i of enabledIntervals) {
                            for (const dir of directionsToUse) {
                                newPool.push({ key: k, degree: d, interval: i, direction: dir });
                            }
                        }
                    }
                }
                
                setPool(newPool);
                setSessionComplete(false);
                if (!keepTimerStatus) setTimerRunning(false);
                setTimeLeft(timerSeconds);
                generateTaskFromPool(newPool, true); 
            }, [enabledIntervals, timerSeconds, scaleDegree, randomizeKey, currentCOF, selectedKey, directionPref, generateTaskFromPool]);

            useEffect(() => { 
                resetPool(timerRunning); 
            }, [scaleDegree, mode, scaleType, accidentalMode, lockStartNote, noRepeats, randomizeKey, directionPref, enabledIntervals]);

            useEffect(() => {
                if (!randomizeKey) resetPool(timerRunning);
            }, [selectedKey]);

            useEffect(() => {
                let intervalId;
                if (timerEnabled && timerRunning && !sessionComplete) {
                    intervalId = setInterval(() => {
                        setTimeLeft((prev) => {
                            if (prev <= 4 && prev > 1) playBeep();
                            if (prev <= 1) { nextTask(); return timerSeconds; }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(intervalId);
            }, [timerEnabled, timerRunning, timerSeconds, nextTask, sessionComplete]);

            const toggleInterval = (id) => setEnabledIntervals(prev => prev.includes(id) ? prev.filter(i => i !== id) : [...prev, id]);
            
            const handleMainAction = () => {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                if (sessionComplete) resetPool();
                else if (timerEnabled) setTimerRunning(!timerRunning);
                else nextTask();
            };

            function renderIntervalDisplay() {
                if (!currentTask || sessionComplete) return null;
                const isUp = currentTask.direction === 'up';
                return (
                    <div className="flex items-center justify-center gap-4 text-5xl md:text-7xl lg:text-8xl font-black">
                        {!isUp && <span className="text-rose-500 animate-pulse">&larr;</span>}
                        <span className="text-white drop-shadow-2xl">{currentTask.label}</span>
                        {isUp && <span className="text-emerald-500 animate-pulse">&rarr;</span>}
                    </div>
                );
            }

            return (
                <div className="min-h-screen pt-14 md:p-6 md:pt-20 overflow-hidden flex flex-col md:flex-row gap-6 animate-in">
                    <aside className="w-full md:w-[380px] bg-slate-900/50 border-b md:border border-slate-800 md:rounded-3xl p-6 overflow-y-auto custom-scrollbar flex flex-col gap-8 shrink-0 z-20">
                        <header className="flex items-center gap-3">
                            <div className="p-2 bg-indigo-500 rounded-xl"><Footprints className="text-white" size={24} /></div>
                            <div>
                                <h2 className="text-lg font-black tracking-tight leading-tight uppercase">Degree Jump</h2>
                                <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Practice Session</p>
                            </div>
                        </header>
                        <section className="space-y-8">
                            <div className="relative flex flex-col items-center">
                                <div className="flex justify-between items-center w-full mb-10 px-2">
                                    <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Circle of Fifths</label>
                                    <div className="flex bg-slate-800 p-1 rounded-lg gap-1">
                                        <button onClick={() => setRandomizeKey(!randomizeKey)} className={`px-2 py-0.5 rounded text-[10px] font-black transition-all flex items-center gap-1 ${randomizeKey ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/20' : 'text-slate-500 hover:text-slate-300'}`}>
                                            <Dices size={12}/> {randomizeKey ? 'RAND' : 'KEY'}
                                        </button>
                                        <div className="w-px h-3 bg-slate-700 my-auto mx-1"></div>
                                        <button onClick={() => setAccidentalMode('flats')} className={`px-2 py-0.5 rounded text-[10px] font-black transition-all ${accidentalMode === 'flats' ? 'bg-indigo-500 text-white' : 'text-slate-500 hover:text-slate-300'}`}>‚ô≠</button>
                                        <button onClick={() => setAccidentalMode('sharps')} className={`px-2 py-0.5 rounded text-[10px] font-black transition-all ${accidentalMode === 'sharps' ? 'bg-indigo-500 text-white' : 'text-slate-500 hover:text-slate-300'}`}>‚ôØ</button>
                                    </div>
                                </div>
                                <div className="relative w-48 h-48 border-2 border-slate-800 rounded-full flex items-center justify-center">
                                    <div className="absolute inset-0 flex items-center justify-center text-slate-700 pointer-events-none"><MusicIcon size={40} className="opacity-10" /></div>
                                    {currentCOF.map((key, i) => {
                                        const angle = (i * (360 / currentCOF.length) - 90) * (Math.PI / 180);
                                        const x = Math.cos(angle) * 80; const y = Math.sin(angle) * 80;
                                        return (
                                            <button key={key} onClick={() => { setSelectedKey(key); setRandomizeKey(false); setTimerRunning(false); }} style={{ transform: `translate(${x}px, ${y}px)` }}
                                                className={`absolute w-10 h-10 rounded-full flex items-center justify-center text-xs font-black transition-all border-2 ${selectedKey === key ? 'bg-indigo-500 border-indigo-400 text-white scale-110 shadow-lg shadow-indigo-500/20' : 'bg-slate-800 border-slate-700 text-slate-400'}`}>
                                                <NoteDisplayComponent note={key} />
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-2">
                                        <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center">Scale</label>
                                        <div className="grid grid-cols-1 gap-1">
                                            {['major', 'minor'].map(t => (
                                                <button key={t} onClick={() => setScaleType(t)} className={`py-2 rounded-xl text-[10px] font-black uppercase tracking-wider transition-all border-2 ${scaleType === t ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800/50 border-slate-800 text-slate-500'}`}>{t}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center">Anchor</label>
                                        <div className="grid grid-cols-1 gap-1">
                                            {['note', 'degree'].map(m => (
                                                <button key={m} onClick={() => setAnchorDisplay(m)} className={`py-2 rounded-xl text-[10px] font-black uppercase tracking-wider transition-all border-2 ${anchorDisplay === m ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800/50 border-slate-800 text-slate-500'}`}>{m}</button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center">Practice Mode</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {['diatonic', 'chromatic'].map(m => (
                                            <button key={m} onClick={() => setMode(m)} className={`py-2 rounded-xl text-[10px] font-black uppercase tracking-wider transition-all border-2 ${mode === m ? 'bg-white text-slate-950 border-white' : 'bg-slate-800/50 border-slate-800 text-slate-500'}`}>{m}</button>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-3">
                                <div className="flex justify-between items-end">
                                    <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Start Position</label>
                                    <span className="text-xs font-black text-indigo-400">
                                        {scaleDegree === 'random' ? 'Dynamic' : (anchorDisplay === 'note' ? currentScale[scaleDegree-1] : getDegreeLabel(scaleDegree-1))}
                                    </span>
                                </div>
                                <div className="grid grid-cols-4 gap-1">
                                    {[1, 2, 3, 4, 5, 6, 7].map(deg => (
                                        <button key={deg} onClick={() => setScaleDegree(deg)} className={`py-3 text-xs font-black rounded-lg transition-all border-2 ${scaleDegree === deg ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800 border-slate-700 text-slate-400'}`}>{deg}</button>
                                    ))}
                                    <button onClick={() => { if(scaleDegree === 'random') nextTask(); else setScaleDegree('random'); }} className={`py-3 rounded-lg border-2 flex items-center justify-center transition-all bg-violet-900/30 border-violet-800/50 text-violet-300 hover:bg-violet-900/50 active:bg-indigo-500 active:text-white`}><Dices size={14} /></button>
                                </div>
                            </div>

                            <div className="space-y-3 pt-2">
                                <div className="flex justify-between items-center px-1">
                                    <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Practice These Jumps</label>
                                    <div className="flex gap-2">
                                        <button onClick={() => setEnabledIntervals(availableIntervals.map(i => i.id))} className="text-[9px] font-black text-indigo-400 uppercase">All</button>
                                        <button onClick={() => setEnabledIntervals([])} className="text-[9px] font-black text-slate-500 uppercase">None</button>
                                    </div>
                                </div>
                                <div className="grid grid-cols-3 gap-1">
                                    {availableIntervals.map((int) => (
                                        <button key={int.id} onClick={() => toggleInterval(int.id)} className={`py-2 text-[10px] font-black rounded-lg border-2 transition-all ${enabledIntervals.includes(int.id) ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800/50 border-slate-800 text-slate-500 hover:border-slate-600'}`}>{int.name}</button>
                                    ))}
                                </div>
                            </div>

                            <div className="space-y-3 pt-2">
                                <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center">Direction</label>
                                <div className="grid grid-cols-3 gap-1">
                                    {[
                                        {id: 'up', icon: <ChevronUp size={14}/>, label: 'UP'},
                                        {id: 'down', icon: <ChevronDown size={14}/>, label: 'DOWN'},
                                        {id: 'random', icon: <Shuffle size={14}/>, label: 'RAND'}
                                    ].map(dir => (
                                        <button key={dir.id} onClick={() => setDirectionPref(dir.id)} className={`flex items-center justify-center gap-2 py-2 rounded-xl border-2 transition-all ${directionPref === dir.id ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800/50 border-slate-800 text-slate-500'}`}>
                                            {dir.icon} <span className="text-[10px] font-black">{dir.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>

                            <div className="flex flex-col gap-3 pt-2">
                                <label className="flex items-center gap-3 group cursor-pointer">
                                    <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${lockStartNote ? 'bg-indigo-500 border-indigo-400' : 'border-slate-700'}`}>{lockStartNote && <div className="w-2 h-2 bg-white rounded-sm" />}</div>
                                    <input type="checkbox" className="hidden" checked={lockStartNote} onChange={e => setLockStartNote(e.target.checked)} />
                                    <span className="text-[10px] font-bold uppercase tracking-widest text-slate-400 group-hover:text-slate-200 transition-colors">Lock Anchor to Scale</span>
                                </label>
                                <label className="flex items-center gap-3 group cursor-pointer">
                                    <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${noRepeats ? 'bg-amber-500 border-amber-400' : 'border-slate-700'}`}>{noRepeats && <div className="w-2 h-2 bg-white rounded-sm" />}</div>
                                    <input type="checkbox" className="hidden" checked={noRepeats} onChange={e => setNoRepeats(e.target.checked)} />
                                    <span className="text-[10px] font-bold uppercase tracking-widest text-slate-400 group-hover:text-slate-200 transition-colors">No Repeats (Per Set)</span>
                                </label>
                            </div>

                            <div className="space-y-3 pt-2 border-t border-slate-800/50">
                                <div className="flex justify-between items-center">
                                    <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2"><Clock size={12} /> Auto-Cycle Timer</label>
                                    <label className="flex items-center gap-2 cursor-pointer group">
                                        <div className={`w-8 h-4 rounded-full relative transition-all border ${timerEnabled ? 'bg-indigo-500 border-indigo-400' : 'bg-slate-800 border-slate-700'}`}><div className={`absolute top-0.5 w-[10px] h-[10px] bg-white rounded-full transition-all ${timerEnabled ? 'left-[14px]' : 'left-0.5'}`} /></div>
                                        <input type="checkbox" className="hidden" checked={timerEnabled} onChange={e => { setTimerEnabled(e.target.checked); if (!e.target.checked) setTimerRunning(false); }} />
                                    </label>
                                </div>
                                <div className="relative group">
                                    <select disabled={!timerEnabled || timerRunning} value={timerSeconds} onChange={e => { const val = Number(e.target.value); setTimerSeconds(val); setTimeLeft(val); }}
                                        className="w-full bg-slate-800 border-2 border-slate-700 rounded-xl py-2.5 px-4 text-xs font-black uppercase tracking-widest outline-none appearance-none cursor-pointer">
                                        {[10, 20, 30, 40, 50, 60].map(s => <option key={s} value={s} className="bg-slate-900">{s} Seconds</option>)}
                                    </select>
                                    <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500"><ChevronDown size={14} /></div>
                                </div>
                            </div>
                        </section>
                    </aside>

                    <main className="flex-1 flex flex-col items-center justify-center p-4 md:p-8 lg:p-12 h-full overflow-hidden z-10">
                        <div className="w-full max-w-4xl max-h-full bg-slate-900 border border-slate-800 rounded-[2.5rem] md:rounded-[3rem] shadow-2xl flex flex-col relative overflow-hidden">
                            {timerEnabled && !sessionComplete && (
                                <div className="absolute top-0 left-0 right-0 h-1.5 bg-slate-800 z-30">
                                    <div className={`h-full bg-indigo-500 transition-all shadow-[0_0_10px_rgba(99,102,241,0.5)] ${timerRunning ? 'duration-1000 ease-linear' : 'duration-300'}`} style={{ width: `${(timeLeft / timerSeconds) * 100}%` }} />
                                </div>
                            )}
                            <div className="absolute inset-0 opacity-[0.03] pointer-events-none overflow-hidden text-white font-black text-[15vw] leading-none p-10 flex flex-col">
                                <span>{formatNote(selectedKey)}</span><span className="self-end">{mode === 'diatonic' ? 'DIA' : 'CHR'}</span>
                            </div>
                            <div className="flex-1 flex flex-col items-center justify-center p-6 md:p-10 lg:p-12 text-center z-10 relative overflow-y-auto custom-scrollbar">
                                {sessionComplete ? (
                                    <div className="space-y-8 animate-in duration-500">
                                        <div className="w-24 h-24 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-500/20"><RotateCcw className="text-emerald-500" size={48} /></div>
                                        <h2 className="text-4xl md:text-6xl font-black text-white italic tracking-tighter uppercase italic">Session Complete</h2>
                                        <button onClick={() => resetPool(false)} className="bg-emerald-500 text-white px-10 py-4 rounded-2xl font-black text-xl hover:bg-emerald-600 shadow-xl">START AGAIN</button>
                                    </div>
                                ) : currentTask && (
                                    <div className="w-full flex flex-col items-center gap-8 md:gap-12 lg:gap-14">
                                        <div className="flex flex-col items-center gap-3 opacity-90">
                                            <span className="text-[10px] font-bold text-slate-500 uppercase tracking-[0.4em] mb-1"><NoteDisplayComponent note={currentTask.key} /> {scaleType === 'major' ? 'Major' : 'Minor'} Context</span>
                                            <div className="flex gap-4">
                                                { (scaleType === 'major' ? MAJOR_SCALES[currentTask.key] : MINOR_SCALES[currentTask.key]).map((note, i) => {
                                                    const displayDegree = currentTask.activeDegree;
                                                    return (
                                                        <div key={i} className="flex flex-col items-center">
                                                            <span className={`text-xs md:text-sm font-black transition-all ${displayDegree === i+1 ? 'text-indigo-400 scale-125' : 'text-slate-600'}`}><NoteDisplayComponent note={note} /></span>
                                                            {displayDegree === i+1 && <div className="w-1 h-1 bg-indigo-500 rounded-full mt-1 animate-pulse" />}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                        <div className="flex items-center justify-center gap-6 md:gap-16 w-full pt-4">
                                            <div className="flex flex-col items-center">
                                                <div className="text-7xl md:text-9xl lg:text-[10rem] font-black text-white leading-none tracking-tighter transition-all">
                                                    {anchorDisplay === 'note' ? <NoteDisplayComponent note={currentTask.startNote} /> : <NoteDisplayComponent note={getDegreeLabel(currentTask.activeDegree - 1)} />}
                                                </div>
                                                <div className="text-[10px] md:text-xs font-black text-indigo-400 uppercase tracking-[0.3em] mt-1 opacity-70 italic">ANCHOR</div>
                                            </div>
                                            <div className="h-24 w-px bg-slate-800 opacity-50 shrink-0"></div>
                                            <div className="flex flex-col items-center relative">
                                                <div className={`text-7xl md:text-9xl lg:text-[10rem] font-black leading-none tracking-tighter cursor-pointer select-none transition-all duration-300 ${showTarget ? 'text-emerald-400 scale-105' : 'text-slate-800 opacity-50 blur-[4px]'}`} onClick={() => setShowTarget(!showTarget)}>
                                                    {showTarget ? <NoteDisplayComponent note={currentTask.endNote} /> : '?'}
                                                </div>
                                                <div className="text-[10px] md:text-xs font-black text-slate-500 uppercase tracking-[0.3em] mt-1 opacity-70 italic">TARGET</div>
                                            </div>
                                        </div>
                                        <div className="flex flex-col items-center gap-2">{renderIntervalDisplay()}</div>
                                        <div className="flex flex-col items-center gap-4 pt-2">
                                            {enabledIntervals.length === 0 ? (
                                                <div className="bg-rose-500/10 border border-rose-500/20 px-6 py-3 rounded-2xl text-rose-400 text-xs font-bold uppercase tracking-widest text-center">Select jumps to practice</div>
                                            ) : (
                                                <div className="flex items-center gap-4">
                                                    <button onClick={handleMainAction} className={`group relative inline-flex items-center gap-4 px-10 py-4 md:px-12 md:py-5 rounded-2xl font-black text-lg md:text-xl transition-all shadow-xl active:scale-95 z-20 ${timerEnabled && timerRunning ? 'bg-rose-500 text-white hover:bg-rose-600' : 'bg-white text-slate-950 hover:bg-rose-500 hover:text-white'}`}>
                                                        {timerEnabled ? (timerRunning ? <><Square size={24} fill="currentColor" />STOP TIMER</> : <><Play size={24} fill="currentColor" />START TIMER</>) : <><RefreshCw size={24} />NEXT INTERVAL</>}
                                                    </button>
                                                    {timerEnabled && <button onClick={() => nextTask()} title="Skip to next" className="p-4 md:p-5 bg-slate-800 text-white border border-slate-800 rounded-2xl hover:bg-slate-700 active:scale-95 group z-20"><ChevronRight size={24} /></button>}
                                                </div>
                                            )}
                                            <div className="flex gap-4 opacity-40"><span className="text-[9px] font-bold border border-slate-700 px-2 py-0.5 rounded uppercase">{timerEnabled ? "Space: Start/Stop ‚Ä¢ ‚Üí: Skip" : "Space: Next"}</span></div>
                                        </div>
                                    </div>
                                )}
                            </div>
                            <div className="p-4 md:p-6 bg-slate-950/40 border-t border-slate-800 flex shrink-0 justify-center items-center gap-12 relative overflow-hidden">
                                <div className="flex flex-col items-center text-center z-10">
                                    <span className="text-[9px] font-bold text-slate-500 uppercase tracking-widest mb-1.5 opacity-60">Scale Map</span>
                                    <div className="flex flex-wrap justify-center gap-1">
                                        {(scaleType === 'major' ? MAJOR_SCALES[selectedKey] : MINOR_SCALES[selectedKey]).map((note, i) => (
                                            <span key={i} className={`text-[10px] font-black px-2 py-0.5 rounded border transition-colors ${currentTask?.activeDegree === i+1 ? 'bg-indigo-500 border-indigo-400 text-white' : 'bg-slate-800 border-slate-700 text-slate-400'}`}><NoteDisplayComponent note={note} /></span>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex flex-col items-center text-center border-l border-slate-800 pl-12 relative z-10">
                                    <span className="text-[9px] font-bold text-amber-500 uppercase tracking-widest mb-1.5 flex items-center gap-1.5"><Layers size={10} /> {noRepeats ? 'Remaining' : 'Total Jumps'}</span>
                                    <div className="flex items-center gap-2"><span className="text-xl font-black text-white">{noRepeats ? pool.length : sessionTotal}</span><span className="text-[10px] font-bold text-slate-600 uppercase tracking-widest">/ {sessionTotal}</span></div>
                                </div>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        // --- Note Flasher Module ---
        function NoteFlasher() {
            const [noteType, setNoteType] = useState('mixed');
            const [noRepeats, setNoRepeats] = useState(false);
            const [timerEnabled, setTimerEnabled] = useState(false);
            const [timerRunning, setTimerRunning] = useState(false);
            const [timerSeconds, setTimerSeconds] = useState(30);
            const [timeLeft, setTimeLeft] = useState(30);
            const [currentNote, setCurrentNote] = useState('');
            const [pool, setPool] = useState([]);
            const [sessionComplete, setSessionComplete] = useState(false);

            const resetPool = useCallback(() => {
                const currentPool = NOTE_POOLS[noteType];
                setPool(Array.from({ length: currentPool.length }, (_, i) => i));
                setSessionComplete(false);
                setTimerRunning(false);
                setTimeLeft(timerSeconds);
            }, [noteType, timerSeconds]);

            useEffect(() => { resetPool(); }, [resetPool, noteType, noRepeats]);

            const nextNote = useCallback((shouldMute = false) => {
                const currentPool = NOTE_POOLS[noteType];
                setTimeLeft(timerSeconds);
                if (!shouldMute) playTing();
                let index;
                let newPool = [...pool];
                if (noRepeats) {
                    if (newPool.length === 0) {
                        setSessionComplete(true);
                        setTimerRunning(false);
                        return;
                    }
                    const poolIdx = Math.floor(Math.random() * newPool.length);
                    index = newPool[poolIdx];
                    newPool.splice(poolIdx, 1);
                    setPool(newPool);
                } else {
                    index = Math.floor(Math.random() * currentPool.length);
                }
                setCurrentNote(currentPool[index]);
            }, [noteType, noRepeats, pool, timerSeconds]);

            useEffect(() => {
                let intervalId;
                if (timerEnabled && timerRunning && !sessionComplete) {
                    intervalId = setInterval(() => {
                        setTimeLeft((prev) => {
                            if (prev <= 4 && prev > 1) playBeep();
                            if (prev <= 1) { nextNote(); return timerSeconds; }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(intervalId);
            }, [timerEnabled, timerRunning, timerSeconds, nextNote, sessionComplete]);

            useEffect(() => { if (!sessionComplete) nextNote(true); }, [noteType]);

            const handleMainAction = () => {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                if (sessionComplete) resetPool();
                else if (timerEnabled) setTimerRunning(!timerRunning);
                else nextNote();
            };

            return (
                <div className="min-h-screen pt-14 md:p-6 md:pt-20 overflow-hidden flex flex-col md:flex-row gap-6 animate-in">
                    <aside className="w-full md:w-[380px] bg-slate-900/50 border-b md:border border-slate-800 md:rounded-3xl p-6 overflow-y-auto custom-scrollbar flex flex-col gap-8 shrink-0 z-20">
                        <header className="flex items-center gap-3">
                            <div className="p-2 bg-rose-500 rounded-xl"><Zap className="text-white" size={24} /></div>
                            <div>
                                <h2 className="text-lg font-black tracking-tight leading-tight uppercase">Note Flasher</h2>
                                <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Identification Practice</p>
                            </div>
                        </header>
                        <section className="space-y-8">
                            <div className="space-y-3">
                                <label className="block text-[10px] font-bold text-slate-500 uppercase tracking-widest text-center">Focus Mode</label>
                                <div className="grid grid-cols-3 gap-2">
                                    {['sharps', 'flats', 'mixed'].map(m => (
                                        <button key={m} onClick={() => setNoteType(m)} className={`py-3 rounded-xl text-[10px] font-black uppercase transition-all border-2 ${noteType === m ? 'bg-white text-slate-950 border-white' : 'bg-slate-800/50 border-slate-800 text-slate-500'}`}>{m}</button>
                                    ))}
                                </div>
                            </div>
                            <div className="flex flex-col gap-3 pt-2">
                                <label className="flex items-center gap-3 group cursor-pointer">
                                    <div className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all ${noRepeats ? 'bg-amber-500 border-amber-400' : 'border-slate-700'}`}>{noRepeats && <div className="w-2 h-2 bg-white rounded-sm" />}</div>
                                    <input type="checkbox" className="hidden" checked={noRepeats} onChange={e => setNoRepeats(e.target.checked)} />
                                    <span className="text-[10px] font-bold uppercase tracking-widest text-slate-400 group-hover:text-slate-200 transition-colors">No Repeats</span>
                                </label>
                            </div>
                            <div className="space-y-3 pt-2 border-t border-slate-800/50">
                                <div className="flex justify-between items-center">
                                    <label className="text-[10px] font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2"><Clock size={12} /> Auto-Cycle Timer</label>
                                    <label className="flex items-center gap-2 cursor-pointer group">
                                        <div className={`w-8 h-4 rounded-full relative transition-all border ${timerEnabled ? 'bg-indigo-500 border-indigo-400' : 'bg-slate-800 border-slate-700'}`}><div className={`absolute top-0.5 w-[10px] h-[10px] bg-white rounded-full transition-all ${timerEnabled ? 'left-[14px]' : 'left-0.5'}`} /></div>
                                        <input type="checkbox" className="hidden" checked={timerEnabled} onChange={e => { setTimerEnabled(e.target.checked); if (!e.target.checked) setTimerRunning(false); }} />
                                    </label>
                                </div>
                                <div className="relative group">
                                    <select disabled={!timerEnabled || timerRunning} value={timerSeconds} onChange={e => { const val = Number(e.target.value); setTimerSeconds(val); setTimeLeft(val); }}
                                        className="w-full bg-slate-800 border-2 border-slate-700 rounded-xl py-2.5 px-4 text-xs font-black uppercase tracking-widest outline-none appearance-none cursor-pointer">
                                        {[10, 20, 30, 40, 50, 60].map(s => <option key={s} value={s} className="bg-slate-900">{s} Seconds</option>)}
                                    </select>
                                    <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500"><ChevronDown size={14} /></div>
                                </div>
                            </div>
                        </section>
                    </aside>
                    <main className="flex-1 flex flex-col items-center justify-center p-4 md:p-8 lg:p-12 h-full overflow-hidden z-10">
                        <div className="w-full max-w-4xl max-h-full bg-slate-900 border border-slate-800 rounded-[2.5rem] md:rounded-[3rem] shadow-2xl flex flex-col relative overflow-hidden">
                            {timerEnabled && !sessionComplete && (
                                <div className="absolute top-0 left-0 right-0 h-1.5 bg-slate-800 z-30">
                                    <div className={`h-full bg-rose-500 transition-all shadow-[0_0_10px_rgba(244,63,94,0.5)] ${timerRunning ? 'duration-1000 ease-linear' : 'duration-300'}`} style={{ width: `${(timeLeft / timerSeconds) * 100}%` }} />
                                </div>
                            )}
                            <div className="flex-1 flex flex-col items-center justify-center p-6 md:p-10 lg:p-12 text-center z-10 relative overflow-y-auto custom-scrollbar">
                                {sessionComplete ? (
                                    <div className="space-y-8 animate-in duration-500">
                                        <div className="w-24 h-24 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-4 border border-emerald-500/20"><RotateCcw className="text-emerald-500" size={48} /></div>
                                        <h2 className="text-4xl md:text-6xl font-black text-white italic tracking-tighter uppercase italic">Session Complete</h2>
                                        <button onClick={resetPool} className="bg-emerald-500 text-white px-10 py-4 rounded-2xl font-black text-xl hover:bg-emerald-600 shadow-xl">START AGAIN</button>
                                    </div>
                                ) : (
                                    <div className="w-full flex flex-col items-center gap-12">
                                        <div className="space-y-4">
                                            <p className="text-[10px] font-bold text-slate-500 uppercase tracking-[0.5em]">Identify the Note</p>
                                            <div className="text-[10rem] md:text-[14rem] lg:text-[16rem] font-black text-white leading-none tracking-tighter drop-shadow-2xl">
                                                <NoteDisplayWidget note={currentNote} />
                                            </div>
                                        </div>
                                        <div className="flex flex-col items-center gap-4">
                                            <button onClick={handleMainAction} 
                                                className={`group relative inline-flex items-center gap-4 px-10 py-4 md:px-12 md:py-5 rounded-2xl font-black text-lg md:text-xl transition-all shadow-xl active:scale-95 z-20 ${timerEnabled && timerRunning ? 'bg-rose-500 text-white hover:bg-rose-600' : 'bg-white text-slate-950 hover:bg-rose-500 hover:text-white'}`}>
                                                {timerEnabled ? (timerRunning ? <><Square size={24} fill="currentColor" />STOP TIMER</> : <><Play size={24} fill="currentColor" />START TIMER</>) : <><RefreshCw size={24} />NEXT NOTE</>}
                                            </button>
                                            {timerEnabled && <button onClick={() => nextNote()} className="p-4 md:p-5 bg-slate-800 text-white border border-slate-800 rounded-2xl hover:bg-slate-700 active:scale-95 group z-20"><ChevronRight size={24} /></button>}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        // --- HOME PAGE MODULE ---

        function HomePage({ onSelect }) {
            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 md:p-12 animate-in pt-24">
                    <div className="max-w-4xl w-full text-center space-y-16">
                        <header className="space-y-4">
                            <h1 className="text-5xl md:text-7xl font-black tracking-tighter text-white uppercase italic">Practice <span className="text-indigo-500">Suite</span></h1>
                            <p className="text-slate-500 font-medium tracking-widest uppercase text-xs md:text-sm">Choose your training exercise</p>
                        </header>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <button onClick={() => onSelect('degreeJump')} className="group relative bg-slate-900 border-2 border-slate-800 hover:border-indigo-500 rounded-[2.5rem] p-8 text-left transition-all hover:scale-[1.02] shadow-2xl overflow-hidden">
                                <div className="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity"><Footprints size={120} /></div>
                                <div className="relative z-10 space-y-4">
                                    <div className="w-12 h-12 bg-indigo-500 rounded-2xl flex items-center justify-center shadow-lg"><Footprints className="text-white" size={24} /></div>
                                    <h3 className="text-2xl font-black text-white uppercase tracking-tight">Degree Jump</h3>
                                    <p className="text-slate-500 text-sm font-medium leading-relaxed max-w-[220px]">Practice relative intervals within major and minor key signatures.</p>
                                    <div className="pt-4 flex items-center gap-2 text-xs font-bold text-indigo-400 uppercase">Enter Session <ChevronRight size={14} /></div>
                                </div>
                            </button>
                            <button onClick={() => onSelect('noteFlasher')} className="group relative bg-slate-900 border-2 border-slate-800 hover:border-rose-500 rounded-[2.5rem] p-8 text-left transition-all hover:scale-[1.02] shadow-2xl overflow-hidden">
                                <div className="absolute top-0 right-0 p-8 opacity-5 group-hover:opacity-10 transition-opacity"><Zap size={120} /></div>
                                <div className="relative z-10 space-y-4">
                                    <div className="w-12 h-12 bg-rose-500 rounded-2xl flex items-center justify-center shadow-lg"><Zap className="text-white" size={24} /></div>
                                    <h3 className="text-2xl font-black text-white uppercase tracking-tight">Note Flasher</h3>
                                    <p className="text-slate-500 text-sm font-medium leading-relaxed max-w-[220px]">Focus on sharp/flat identification and speed training.</p>
                                    <div className="pt-4 flex items-center gap-2 text-xs font-bold text-rose-400 uppercase">Enter Session <ChevronRight size={14} /></div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- ROOT APP ---

        function App() {
            const [currentView, setCurrentView] = useState('home');
            return (
                <div className="min-h-screen bg-slate-950">
                    <Navbar activeView={currentView} onNavigate={setCurrentView} />
                    {currentView === 'degreeJump' ? <DegreeJump /> : currentView === 'noteFlasher' ? <NoteFlasher /> : <HomePage onSelect={setCurrentView} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>